/**
 * Course module selector.
 *
 * @copyright  2018 Frédéric Massart
 * @author     Frédéric Massart <fred@branchup.tech>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_xp/cm-selector",["jquery","core/ajax","block_xp/course-resource-selector","block_xp/cm-resource-selector"],(function($,Ajax,CourseResourceSelector,CmResourceSelector){var lastUsedCourse=null;return{init:function(selector,initWithCourse){initWithCourse=initWithCourse||lastUsedCourse;var container=$(selector),currentCourse=null,searchResultsContents=container.find(".search-result-contents"),courseSearchField=container.find(".search-term-course"),cmSearchField=container.find(".search-term-cm"),cs=new CourseResourceSelector(searchResultsContents,courseSearchField);cs.onResourceSelected((function(e,resource){resource._iscourse&&selectCourse(resource.course)}));var cms=new CmResourceSelector(searchResultsContents,cmSearchField);function reset(){courseSearchField.val(""),cmSearchField.val(""),cs.clear(),container.find(".cm-search").hide(),container.find(".course-search .course-not-selected").show(),container.find(".course-search .course-selected").hide(),currentCourse=null,courseSearchField.focus()}function selectCourse(course){currentCourse=course,lastUsedCourse=course,container.find(".course-search .course-selected span").text(course.fullname),container.find(".course-search .course-selected").show(),container.find(".course-search .course-not-selected").hide(),container.find(".cm-search").show(),cs.clear(),cms.initForCourse(course.id),cmSearchField.val(""),cmSearchField.focus()}cms.onResourceSelected((function(e,resource){resource._iscm&&container.trigger("cm-selected",{cm:resource.cm,course:currentCourse})})),container.find(".course-selection-change").on("click",(function(){reset()})),initWithCourse?selectCourse(initWithCourse):reset()}}}));

//# sourceMappingURL=cm-selector.min.js.map