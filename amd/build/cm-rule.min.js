/**
 * Course module rule.
 *
 * @author     Frédéric Massart <fred@branchup.tech>
 * @copyright  2018 Frédéric Massart
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_xp/cm-rule",["jquery","core/templates","core/str","block_xp/dialogue-base"],(function($,Templates,Str,DialogueBase){function Dialogue(initWithCourse){this.initWithCourse=initWithCourse||null,DialogueBase.prototype.constructor.apply(this,[])}return Dialogue.prototype=Object.create(DialogueBase.prototype),Dialogue.prototype.constructor=Dialogue,Dialogue.prototype._render=function(){var initWithCourseJson=JSON.stringify(this.initWithCourse);return Str.get_string("cmselector","block_xp").then(function(title){return Templates.render("block_xp/cm-selector",{initwithcoursejson:initWithCourseJson}).then(function(html,js){this.setTitle(title),this._setDialogueContent(html),Templates.runTemplateJS(js),this.center(),this.find(".block_xp-cm-selector-widget").on("cm-selected",function(e,resource){this.trigger("cm-selected",resource),this.close()}.bind(this))}.bind(this))}.bind(this))},{init:function(initWithCourse){$(".block-xp-filters").on("click",".block_xp-cm-rule-widget button",(function(e){e.preventDefault();var node=$(e.target).closest(".block_xp-cm-rule-widget");if(node){var d=new Dialogue(initWithCourse);d.on("cm-selected",(function(e,resource){var cm=resource.cm,course=resource.course;node.find(".cm-rule-contextid").val(cm.contextid),node.find(".cm-selected").text(M.util.get_string("rulecmdescwithcourse","block_xp",{contextname:cm.name,coursename:course.shortname})),node.addClass("has-cm")})),d.show()}}))}}}));

//# sourceMappingURL=cm-rule.min.js.map