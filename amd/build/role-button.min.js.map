{"version":3,"file":"role-button.min.js","sources":["../src/role-button.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Role button.\n *\n * @copyright  2022 Frédéric Massart\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n    /**\n     * Delegate click to a zone.\n     *\n     * @param {String} rootSelector The root selector.\n     * @param {String} nodeSelector The node on which the event must happen.\n     * @param {Function} onClick The callback, receiving the node.\n     */\n    function delegateClick(rootSelector, nodeSelector, onClick) {\n        const nodes = document.querySelectorAll(rootSelector);\n\n        const handleHit = (e) => {\n            const node = e.target.closest('[role=button]');\n            if (node && node.matches(nodeSelector)) {\n                if (e.defaultPrevented) {\n                    return;\n                }\n                e.preventDefault();\n                onClick(node);\n            }\n        };\n\n        nodes.forEach((node) => {\n            node.addEventListener('click', handleHit);\n\n            node.addEventListener('mousedown', (e) => {\n                if (e.key !== ' ' && e.key !== 'Enter') {\n                    return;\n                }\n                handleHit(e);\n            });\n\n            node.querySelectorAll(nodeSelector).forEach((node) => {\n                if (!node.getAttribute('role')) {\n                    node.setAttribute('role', 'button');\n                }\n            });\n        });\n    }\n\n    /**\n     * Register a click.\n     *\n     * @param {String} selector The selector.\n     * @param {Function} onClick The callback, receiving the node.\n     */\n    function registerClick(selector, onClick) {\n        const nodes = document.querySelectorAll(selector);\n\n        nodes.forEach((node) => {\n            const handleHit = (e) => {\n                if (e.defaultPrevented) {\n                    return;\n                }\n                e.preventDefault();\n                onClick(node);\n            };\n\n            node.addEventListener('click', handleHit);\n            node.addEventListener('mousedown', (e) => {\n                if (e.key !== ' ' && e.key !== 'Enter') {\n                    return;\n                }\n                handleHit(e);\n            });\n\n            if (!node.getAttribute('role')) {\n                node.setAttribute('role', 'button');\n            }\n        });\n    }\n\n    return {\n        delegateClick,\n        registerClick,\n    };\n});\n"],"names":["define","delegateClick","rootSelector","nodeSelector","onClick","nodes","document","querySelectorAll","handleHit","e","node","target","closest","matches","defaultPrevented","preventDefault","forEach","addEventListener","key","getAttribute","setAttribute","registerClick","selector"],"mappings":";;;;;;;AAuBAA,8BAAO,IAAI,iBAwEA,CACHC,uBAjEmBC,aAAcC,aAAcC,eACzCC,MAAQC,SAASC,iBAAiBL,cAElCM,UAAaC,UACTC,KAAOD,EAAEE,OAAOC,QAAQ,oBAC1BF,MAAQA,KAAKG,QAAQV,cAAe,IAChCM,EAAEK,wBAGNL,EAAEM,iBACFX,QAAQM,QAIhBL,MAAMW,SAASN,OACXA,KAAKO,iBAAiB,QAAST,WAE/BE,KAAKO,iBAAiB,aAAcR,IAClB,MAAVA,EAAES,KAAyB,UAAVT,EAAES,KAGvBV,UAAUC,MAGdC,KAAKH,iBAAiBJ,cAAca,SAASN,OACpCA,KAAKS,aAAa,SACnBT,KAAKU,aAAa,OAAQ,iBAwCtCC,uBA5BmBC,SAAUlB,SACfE,SAASC,iBAAiBe,UAElCN,SAASN,aACLF,UAAaC,IACXA,EAAEK,mBAGNL,EAAEM,iBACFX,QAAQM,QAGZA,KAAKO,iBAAiB,QAAST,WAC/BE,KAAKO,iBAAiB,aAAcR,IAClB,MAAVA,EAAES,KAAyB,UAAVT,EAAES,KAGvBV,UAAUC,MAGTC,KAAKS,aAAa,SACnBT,KAAKU,aAAa,OAAQ"}