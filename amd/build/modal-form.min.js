define(["exports","core_form/modalform","block_xp/compat","block_xp/role-button"],(function(_exports,_modalform,Compat,RoleButton){var obj;
/**
   * Modal form.
   *
   * @module     block_xp/modal-form
   * @copyright  2024 Frédéric Massart
   * @author     Frédéric Massart <fred@branchup.tech>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.delegateOpen=function(rootSelector,selector){RoleButton.delegateClick(rootSelector,selector,(node=>{open(node)}))},_exports.extractNodeData=extractNodeData,_exports.registerOpen=function(selector){RoleButton.registerClick(selector,(node=>{open(node)}))},_modalform=(obj=_modalform)&&obj.__esModule?obj:{default:obj},Compat=_interopRequireWildcard(Compat),RoleButton=_interopRequireWildcard(RoleButton);function open(node){var _modalConfig$title;const formClass=node.dataset.formClass,formArgs=extractNodeData(node,"formArgs"),modalConfig=extractNodeData(node,"modal");var modalForm=new _modalform.default({formClass:formClass,args:formArgs,returnFocus:node,saveButtonText:modalConfig.saveButtonText,modalConfig:{title:null!==(_modalConfig$title=modalConfig.title)&&void 0!==_modalConfig$title?_modalConfig$title:node.textContent.slice(0,100)}});modalForm.addEventListener(modalForm.events.LOADED,(()=>{var _modalConfig$buttons;modalForm.modal.getRoot().addClass("block_xp");const saveBtn=((modalForm,action)=>{const saveBtnJq=modalForm.modal.getFooter().find(modalForm.modal.getActionSelector(action));return saveBtnJq.length?saveBtnJq[0]:null})(modalForm,"save");if(saveBtn&&null!==(_modalConfig$buttons=modalConfig.buttons)&&void 0!==_modalConfig$buttons&&_modalConfig$buttons.save){var _modalConfig$buttons$,_modalConfig$buttons$3,_modalConfig$buttons$2;if(null!==(_modalConfig$buttons$=modalConfig.buttons.save)&&void 0!==_modalConfig$buttons$&&_modalConfig$buttons$.label)saveBtn.textContent=null===(_modalConfig$buttons$2=modalConfig.buttons.save)||void 0===_modalConfig$buttons$2?void 0:_modalConfig$buttons$2.label;null!==(_modalConfig$buttons$3=modalConfig.buttons.save)&&void 0!==_modalConfig$buttons$3&&_modalConfig$buttons$3.danger&&(saveBtn.classList.remove("btn-primary"),saveBtn.classList.add("btn-danger"))}})),modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{e.preventDefault(),Compat.markFormSubmitted(Compat.getFormNode(modalForm)),e.detail&&e.detail.redirecturl?window.location.href=M.cfg.wwwroot+e.detail.redirecturl:window.location.reload(),setTimeout((()=>{modalForm.modal.hide()}),1e3)})),modalForm.show()}function extractNodeData(node,prefix){return Object.keys(node.dataset).filter((k=>0===k.indexOf(prefix))).reduce(((carry,k)=>{let value=node.dataset[k];"true"!==value&&"false"!==value||(value="true"===value);let key=k.charAt(prefix.length).toLocaleLowerCase()+k.substring(prefix.length+1);return key.indexOf("__")>-1?function(obj,keys,value){let currentObj=obj;for(let i=0;i<keys.length-1;i++){const key=keys[i];currentObj[key]=void 0===currentObj[key]?{}:currentObj[key],currentObj=currentObj[key]}const lastKey=keys[keys.length-1];return currentObj[lastKey]=value,obj}(carry,key.split("__"),value):{...carry,[key]:value}}),{})}}));

//# sourceMappingURL=modal-form.min.js.map