define(["exports","core_form/modalform","block_xp/compat","block_xp/role-button"],(function(_exports,_modalform,Compat,RoleButton){var obj;
/**
   * Modal form.
   *
   * @module     block_xp/modal-form
   * @copyright  2024 Frédéric Massart
   * @author     Frédéric Massart <fred@branchup.tech>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function open(node){var _modalConfig$title;const formClass=node.dataset.formClass,formArgs=extractNodeData(node,"formArgs"),modalConfig=extractNodeData(node,"modal");var modalForm=new _modalform.default({formClass:formClass,args:formArgs,returnFocus:node,saveButtonText:modalConfig.saveButtonText,modalConfig:{title:null!==(_modalConfig$title=modalConfig.title)&&void 0!==_modalConfig$title?_modalConfig$title:node.textContent.slice(0,100)}});modalForm.addEventListener(modalForm.events.LOADED,(()=>{modalForm.modal.getRoot().addClass("block_xp")})),modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{e.preventDefault(),Compat.markFormSubmitted(Compat.getFormNode(modalForm)),e.detail&&e.detail.redirecturl?window.location.href=M.cfg.wwwroot+e.detail.redirecturl:window.location.reload()})),modalForm.show()}function extractNodeData(node,prefix){return Object.keys(node.dataset).filter((k=>0===k.indexOf(prefix))).reduce(((carry,k)=>{let value=node.dataset[k];"true"!==value&&"false"!==value||(value="true"===value);let key=k.charAt(prefix.length).toLocaleLowerCase()+k.substring(prefix.length+1);if(key.indexOf("__")>-1){let[parentKey,childKey]=key.split("__",2);if(parentKey)return{...carry,[parentKey]:{...carry[parentKey]||{},[childKey]:value}};key=childKey}return{...carry,[key]:value}}),{})}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.delegateOpen=function(rootSelector,selector){RoleButton.delegateClick(rootSelector,selector,(node=>{open(node)}))},_exports.registerOpen=function(selector){RoleButton.registerClick(selector,(node=>{open(node)}))},_modalform=(obj=_modalform)&&obj.__esModule?obj:{default:obj},Compat=_interopRequireWildcard(Compat),RoleButton=_interopRequireWildcard(RoleButton)}));

//# sourceMappingURL=modal-form.min.js.map