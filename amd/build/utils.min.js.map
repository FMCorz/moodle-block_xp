{"version":3,"file":"utils.min.js","sources":["../src/utils.js"],"sourcesContent":["// This file is part of Level Up XP.\n//\n// Level Up XP is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Level Up XP is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Level Up XP.  If not, see <https://www.gnu.org/licenses/>.\n//\n// https://levelup.plus\n\n/**\n * Utils.\n *\n * @module     block_xp/utils\n * @copyright  2025 Frédéric Massart\n * @author     Frédéric Massart <fred@branchup.tech>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Copy to clipboard.\n *\n * @param {String} str\n * @param {Node} [parentNode] The parent node for fallback logic.\n * @returns\n */\nexport async function copyToClipboard(str, parentNode) {\n    if (navigator.clipboard) {\n        try {\n            await navigator.clipboard.writeText(str);\n        } catch (e) {\n            return;\n        }\n        return;\n    }\n    var el = document.createElement('textarea');\n    el.value = str;\n    el.setAttribute('readonly', '');\n    el.style.position = 'absolute';\n    el.style.left = '-99999px';\n    const parent = parentNode || document.body;\n    parent.appendChild(el);\n    el.select();\n    document.execCommand('copy');\n    parent.removeChild(el);\n}\n\n\n/**\n * Extract data from dataset.\n *\n * This extracts data at a prefix, and converts in nested objects if needed.\n *\n * @param {Node} node The HTML node.\n * @param {String} prefix The data prefix.\n * @returns {Object}\n */\nexport function extractNodeData(node, prefix) {\n    return Object.keys(node.dataset).filter(k => k.indexOf(prefix) === 0).reduce((carry, k) => {\n        let value = node.dataset[k];\n        if (value === 'true' || value === 'false') {\n            value = value === 'true' ? true : false;\n        }\n        let key = k.charAt(prefix.length).toLocaleLowerCase() + k.substring(prefix.length + 1);\n\n        if (key.indexOf('__') > -1) {\n            return setAtDepth(carry, key.split('__'), value);\n        }\n\n        return {...carry, [key]: value};\n    }, {});\n}\n\n/**\n * Get data from a JSON script tag.\n *\n * @param {String} scriptId The script ID.\n * @returns {Object}\n */\nexport function getDataFromJsonScript(scriptId) {\n    const script = document.getElementById(scriptId);\n    if (!script || script.tagName !== 'SCRIPT' || script.type !== 'application/json') {\n        return {};\n    }\n    try {\n        return JSON.parse(script.textContent);\n    } catch (e) {\n        return {};\n    }\n}\n\n/**\n * Set a value at a specific depth in an object.\n *\n * @param {Object} obj\n * @param {String[]} keys\n * @param {Any} value\n * @returns {Object}\n */\nfunction setAtDepth(obj, keys, value) {\n    let currentObj = obj;\n\n    for (let i = 0; i < keys.length - 1; i++) {\n        const key = keys[i];\n        currentObj[key] = typeof currentObj[key] === 'undefined' ? {} : currentObj[key];\n        currentObj = currentObj[key];\n    }\n\n    const lastKey = keys[keys.length - 1];\n    currentObj[lastKey] = value;\n\n    return obj;\n}"],"names":["str","parentNode","navigator","clipboard","writeText","e","el","document","createElement","value","setAttribute","style","position","left","parent","body","appendChild","select","execCommand","removeChild","node","prefix","Object","keys","dataset","filter","k","indexOf","reduce","carry","key","charAt","length","toLocaleLowerCase","substring","obj","currentObj","i","lastKey","setAtDepth","split","scriptId","script","getElementById","tagName","type","JSON","parse","textContent"],"mappings":";;;;;;;;;eAiCsCA,IAAKC,eACnCC,UAAUC,UAAW,WAEXD,UAAUC,UAAUC,UAAUJ,KACtC,MAAOK,qBAKTC,GAAKC,SAASC,cAAc,YAChCF,GAAGG,MAAQT,IACXM,GAAGI,aAAa,WAAY,IAC5BJ,GAAGK,MAAMC,SAAW,WACpBN,GAAGK,MAAME,KAAO,iBACVC,OAASb,YAAcM,SAASQ,KACtCD,OAAOE,YAAYV,IACnBA,GAAGW,SACHV,SAASW,YAAY,QACrBJ,OAAOK,YAAYb,uCAaSc,KAAMC,eAC3BC,OAAOC,KAAKH,KAAKI,SAASC,QAAOC,GAA2B,IAAtBA,EAAEC,QAAQN,UAAeO,QAAO,CAACC,MAAOH,SAC7EjB,MAAQW,KAAKI,QAAQE,GACX,SAAVjB,OAA8B,UAAVA,QACpBA,MAAkB,SAAVA,WAERqB,IAAMJ,EAAEK,OAAOV,OAAOW,QAAQC,oBAAsBP,EAAEQ,UAAUb,OAAOW,OAAS,UAEhFF,IAAIH,QAAQ,OAAS,WAkCbQ,IAAKZ,KAAMd,WACvB2B,WAAaD,QAEZ,IAAIE,EAAI,EAAGA,EAAId,KAAKS,OAAS,EAAGK,IAAK,OAChCP,IAAMP,KAAKc,GACjBD,WAAWN,UAAkC,IAApBM,WAAWN,KAAuB,GAAKM,WAAWN,KAC3EM,WAAaA,WAAWN,WAGtBQ,QAAUf,KAAKA,KAAKS,OAAS,UACnCI,WAAWE,SAAW7B,MAEf0B,IA7CQI,CAAWV,MAAOC,IAAIU,MAAM,MAAO/B,OAGvC,IAAIoB,OAAQC,KAAMrB,SAC1B,6CAS+BgC,gBAC5BC,OAASnC,SAASoC,eAAeF,cAClCC,QAA6B,WAAnBA,OAAOE,SAAwC,qBAAhBF,OAAOG,WAC1C,cAGAC,KAAKC,MAAML,OAAOM,aAC3B,MAAO3C,SACE"}