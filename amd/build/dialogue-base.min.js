/**
 * Generic dialogue base.
 *
 * This is originally a copy of block_stash/dialogue-base.
 *
 * @copyright  2018 Frédéric Massart
 * @author     Frédéric Massart <fred@branchup.tech>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_xp/dialogue-base",["jquery","core/yui","core/str","core/notification"],(function($,Y,Str,Notification){function DialogueBase(){this._eventNode=$("<div>");var deferred=$.Deferred();this._ready=deferred.promise(),Y.use("moodle-core-notification",function(){this._init().then((function(){deferred.resolve()})).catch(Notification.exception)}.bind(this))}return DialogueBase.prototype._dialogue=null,DialogueBase.prototype._eventNode=null,DialogueBase.prototype._ready=null,DialogueBase.prototype._title="&hellip;",DialogueBase.prototype.center=function(){this._dialogue.centerDialogue()},DialogueBase.prototype._init=function(){var d,deferred=$.Deferred(),loading=Y.Node.create('<p style="text-align: center;"><img src="'+M.util.image_url("y/loading")+'" alt=""></p>');d=new M.core.dialogue({draggable:!0,modal:!0,width:"600px"}),this._dialogue=d;var origHide=d.hide;return d.hide=function(){origHide.apply(d,arguments),this.destroy()}.bind(d),d.getStdModNode(Y.WidgetStdMod.HEADER).prepend(Y.Node.create("<h1>")),this._updateDialogueTitle(),this._setDialogueContent(loading),deferred.resolve(),this._render().fail(function(){Str.get_string("error","core").then((function(a){return a})).fail((function(){return""})).always(function(txt){this._setDialogueContent(txt)}.bind(this))}.bind(this)),deferred.promise()},DialogueBase.prototype.close=function(){this.trigger("dialogue-closed"),this._dialogue.destroy(),this._eventNode=null},DialogueBase.prototype.find=function(selector){return $(this._dialogue.getStdModNode(Y.WidgetStdMod.BODY).getDOMNode()).find(selector)},DialogueBase.prototype.on=function(type,callback){this._eventNode.on(type,callback)},DialogueBase.prototype._render=function(){},DialogueBase.prototype.show=function(e){this._ready.then(function(){this._dialogue.show(e)}.bind(this)).catch(Notification.exception)},DialogueBase.prototype._setDialogueContent=function(content){this._dialogue.setStdModContent(Y.WidgetStdMod.BODY,content,Y.WidgetStdMod.REPLACE)},DialogueBase.prototype.setTitle=function(title){this._title=title,this._updateDialogueTitle()},DialogueBase.prototype.trigger=function(type,extraArgs){this._eventNode.trigger(type,extraArgs)},DialogueBase.prototype._updateDialogueTitle=function(){this._dialogue&&this._dialogue.getStdModNode(Y.WidgetStdMod.HEADER).one("h1").setHTML(this._title)},DialogueBase}));

//# sourceMappingURL=dialogue-base.min.js.map